<Window x:Class="HomeMaintenanceManager.WPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Home Maintenance Manager" 
        Height="900" 
        Width="1400"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <!-- Стили для карточек задач -->
        <Style x:Key="TaskCardStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>

        <!-- Стиль для индикатора приоритета -->
        <Style x:Key="PriorityIndicatorStyle" TargetType="Border">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Priority}" Value="Critical">
                    <Setter Property="Background" Value="#FF4444"/>
                    <Setter Property="ToolTip" Value="Критический приоритет"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Priority}" Value="High">
                    <Setter Property="Background" Value="#FFAA44"/>
                    <Setter Property="ToolTip" Value="Высокий приоритет"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Priority}" Value="Medium">
                    <Setter Property="Background" Value="#44AAFF"/>
                    <Setter Property="ToolTip" Value="Средний приоритет"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Priority}" Value="Low">
                    <Setter Property="Background" Value="#44CC88"/>
                    <Setter Property="ToolTip" Value="Низкий приоритет"/>
                </DataTrigger>
            </Style.Triggers>
            <Setter Property="Width" Value="12"/>
            <Setter Property="Height" Value="12"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Margin" Value="0,0,6,0"/>
        </Style>

        <!-- Стиль для колонок Kanban -->
        <Style x:Key="KanbanColumnStyle" TargetType="Border">
            <Setter Property="Background" Value="#F8F9FA"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Padding" Value="12"/>
            <Setter Property="Width" Value="300"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header с поиском и фильтрами -->
        <Border Grid.Row="0" Background="#2C3E50" Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Заголовок -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="🏠 Home Maintenance Manager" 
                              Foreground="White" 
                              FontSize="20" 
                              FontWeight="Bold"
                              Margin="0,0,20,0"/>

                    <!-- Статистика -->
                    <StackPanel Orientation="Horizontal" Margin="10,0,0,0">
                        <Border Background="#27AE60" CornerRadius="4" Padding="8,4" Margin="0,0,8,0">
                            <TextBlock Text="{Binding TotalTasksCount}" 
                                      Foreground="White" 
                                      FontWeight="Bold"
                                      ToolTip="Всего задач"/>
                        </Border>
                        <Border Background="#E74C3C" CornerRadius="4" Padding="8,4" Margin="0,0,8,0">
                            <TextBlock Text="{Binding OverdueTasksCount}" 
                                      Foreground="White" 
                                      FontWeight="Bold"
                                      ToolTip="Просроченные"/>
                        </Border>
                        <Border Background="#3498DB" CornerRadius="4" Padding="8,4">
                            <TextBlock Text="{Binding CompletedTasksCount}" 
                                      Foreground="White" 
                                      FontWeight="Bold"
                                      ToolTip="Выполненные"/>
                        </Border>
                    </StackPanel>
                </StackPanel>

                <!-- Поиск и фильтры -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                    <!-- Поиск -->
                    <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                            Width="200" 
                            Height="30" 
                            Padding="8"
                            Margin="0,0,10,0"
                            ToolTip="Поиск по названию и описанию">
                        <TextBox.Style>
                            <Style TargetType="TextBox">
                                <Setter Property="Background" Value="White"/>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#F5F5F5"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </TextBox.Style>
                    </TextBox>

                    <!-- Кнопка очистки фильтров -->
                    <Button Content="❌ Очистить" 
                            Command="{Binding ClearFiltersCommand}"
                            ToolTip="Очистить все фильтры"
                            Background="#95A5A6" 
                            Foreground="White"
                            Height="30" 
                            Padding="8,0"
                            Margin="0,0,10,0"/>
                </StackPanel>

                <!-- Кнопки действий -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button Content="🔄" 
                            Command="{Binding RefreshCommand}"
                            ToolTip="Обновить данные"
                            Width="40" 
                            Height="30" 
                            Margin="4,0"
                            Background="#3498DB" 
                            Foreground="White"/>

                    <Button Content="➕ Создать" 
                            Command="{Binding CreateTaskCommand}"
                            ToolTip="Создать новую задачу"
                            Background="#27AE60" 
                            Foreground="White"
                            Padding="12,4"
                            Height="30" 
                            Margin="4,0"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Основной контент - Kanban доска -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
            <StackPanel Orientation="Horizontal" Margin="16">

                <!-- Колонка: Запланировано -->
                <Border Style="{StaticResource KanbanColumnStyle}">
                    <StackPanel>
                        <TextBlock Text="📋 Запланировано" 
                                  FontWeight="Bold" 
                                  FontSize="14"
                                  Margin="0,0,0,12"
                                  Foreground="#2C3E50"/>

                        <TextBlock Text="{Binding PlannedTasks.Count, StringFormat={}Задач: {0}}"
                                  FontSize="11"
                                  Foreground="#7F8C8D"
                                  Margin="0,0,0,8"/>

                        <ItemsControl ItemsSource="{Binding PlannedTasks}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Style="{StaticResource TaskCardStyle}" 
                                            MouseDown="TaskCard_MouseDown">
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="*"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>

                                            <!-- Заголовок и приоритет -->
                                            <StackPanel Grid.Row="0" Orientation="Horizontal" VerticalAlignment="Center">
                                                <Border Style="{StaticResource PriorityIndicatorStyle}"/>
                                                <TextBlock Text="{Binding Title}" 
                                                          FontWeight="SemiBold"
                                                          TextWrapping="Wrap"
                                                          FontSize="12"/>
                                            </StackPanel>

                                            <!-- Мета-информация -->
                                            <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,6,0,0">
                                                <TextBlock Text="{Binding Category}" 
                                                          Foreground="#666"
                                                          FontSize="10"/>
                                                <TextBlock Text=" • " 
                                                          Foreground="#666"
                                                          FontSize="10"/>
                                                <TextBlock Text="{Binding Executor}" 
                                                          Foreground="#666"
                                                          FontSize="10"/>
                                            </StackPanel>

                                            <!-- Описание -->
                                            <TextBlock Grid.Row="2" 
                                                      Text="{Binding Description}" 
                                                      FontSize="10"
                                                      Foreground="#666"
                                                      TextWrapping="Wrap"
                                                      Margin="0,6,0,0"
                                                      MaxHeight="40"
                                                      TextTrimming="CharacterEllipsis"/>

                                            <!-- Дата и действия -->
                                            <Grid Grid.Row="3" Margin="0,8,0,0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Grid.Column="0" 
                                                          Text="{Binding PlannedDate, StringFormat='dd.MM.yyyy'}" 
                                                          FontSize="9"
                                                          Foreground="#999"
                                                          VerticalAlignment="Center"/>

                                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                                    <Button Content="▶️" 
                                                            Command="{Binding DataContext.MarkInProgressCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                            CommandParameter="{Binding}"
                                                            ToolTip="Начать выполнение"
                                                            Width="24" 
                                                            Height="24"
                                                            Margin="2,0"/>
                                                    <Button Content="✅" 
                                                            Command="{Binding DataContext.MarkCompletedCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                            CommandParameter="{Binding}"
                                                            ToolTip="Отметить выполненной"
                                                            Width="24" 
                                                            Height="24"
                                                            Margin="2,0"/>
                                                    <Button Content="📋" 
                                                            Command="{Binding DataContext.DuplicateTaskCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                            CommandParameter="{Binding}"
                                                            ToolTip="Дублировать"
                                                            Width="24" 
                                                            Height="24"
                                                            Margin="2,0"/>
                                                </StackPanel>
                                            </Grid>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>

                <!-- Колонка: В процессе -->
                <Border Style="{StaticResource KanbanColumnStyle}">
                    <StackPanel>
                        <TextBlock Text="🔄 В процессе" 
                                  FontWeight="Bold" 
                                  FontSize="14"
                                  Margin="0,0,0,12"
                                  Foreground="#2C3E50"/>

                        <TextBlock Text="{Binding InProgressTasks.Count, StringFormat={}Задач: {0}}"
                                  FontSize="11"
                                  Foreground="#7F8C8D"
                                  Margin="0,0,0,8"/>

                        <ItemsControl ItemsSource="{Binding InProgressTasks}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Style="{StaticResource TaskCardStyle}" 
                                            MouseDown="TaskCard_MouseDown">
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="*"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>

                                            <StackPanel Grid.Row="0" Orientation="Horizontal" VerticalAlignment="Center">
                                                <Border Style="{StaticResource PriorityIndicatorStyle}"/>
                                                <TextBlock Text="{Binding Title}" 
                                                          FontWeight="SemiBold"
                                                          TextWrapping="Wrap"
                                                          FontSize="12"/>
                                            </StackPanel>

                                            <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,6,0,0">
                                                <TextBlock Text="{Binding Category}" 
                                                          Foreground="#666"
                                                          FontSize="10"/>
                                                <TextBlock Text=" • " 
                                                          Foreground="#666"
                                                          FontSize="10"/>
                                                <TextBlock Text="{Binding Executor}" 
                                                          Foreground="#666"
                                                          FontSize="10"/>
                                            </StackPanel>

                                            <TextBlock Grid.Row="2" 
                                                      Text="{Binding Description}" 
                                                      FontSize="10"
                                                      Foreground="#666"
                                                      TextWrapping="Wrap"
                                                      Margin="0,6,0,0"
                                                      MaxHeight="40"
                                                      TextTrimming="CharacterEllipsis"/>

                                            <Grid Grid.Row="3" Margin="0,8,0,0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Grid.Column="0" 
                                                          Text="{Binding PlannedDate, StringFormat='dd.MM.yyyy'}" 
                                                          FontSize="9"
                                                          Foreground="#999"
                                                          VerticalAlignment="Center"/>

                                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                                    <Button Content="✅" 
                                                            Command="{Binding DataContext.MarkCompletedCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                            CommandParameter="{Binding}"
                                                            ToolTip="Отметить выполненной"
                                                            Width="24" 
                                                            Height="24"
                                                            Margin="2,0"/>
                                                    <Button Content="✏️" 
                                                            Command="{Binding DataContext.EditTaskCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                            CommandParameter="{Binding}"
                                                            ToolTip="Редактировать"
                                                            Width="24" 
                                                            Height="24"
                                                            Margin="2,0"/>
                                                </StackPanel>
                                            </Grid>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>

                <!-- Колонка: Выполнено -->
                <Border Style="{StaticResource KanbanColumnStyle}">
                    <StackPanel>
                        <TextBlock Text="✅ Выполнено" 
                                  FontWeight="Bold" 
                                  FontSize="14"
                                  Margin="0,0,0,12"
                                  Foreground="#2C3E50"/>

                        <TextBlock Text="{Binding CompletedTasks.Count, StringFormat={}Задач: {0}}"
                                  FontSize="11"
                                  Foreground="#7F8C8D"
                                  Margin="0,0,0,8"/>

                        <ItemsControl ItemsSource="{Binding CompletedTasks}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Style="{StaticResource TaskCardStyle}" 
                                            MouseDown="TaskCard_MouseDown">
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="*"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>

                                            <StackPanel Grid.Row="0" Orientation="Horizontal" VerticalAlignment="Center">
                                                <Border Style="{StaticResource PriorityIndicatorStyle}"/>
                                                <TextBlock Text="{Binding Title}" 
                                                          FontWeight="SemiBold"
                                                          TextWrapping="Wrap"
                                                          FontSize="12"
                                                          Foreground="#27AE60"/>
                                            </StackPanel>

                                            <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,6,0,0">
                                                <TextBlock Text="{Binding Category}" 
                                                          Foreground="#666"
                                                          FontSize="10"/>
                                                <TextBlock Text=" • " 
                                                          Foreground="#666"
                                                          FontSize="10"/>
                                                <TextBlock Text="Выполнено" 
                                                          Foreground="#27AE60"
                                                          FontSize="10"
                                                          FontWeight="SemiBold"/>
                                            </StackPanel>

                                            <TextBlock Grid.Row="2" 
                                                      Text="{Binding Description}" 
                                                      FontSize="10"
                                                      Foreground="#666"
                                                      TextWrapping="Wrap"
                                                      Margin="0,6,0,0"
                                                      MaxHeight="40"
                                                      TextTrimming="CharacterEllipsis"/>

                                            <Grid Grid.Row="3" Margin="0,8,0,0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Grid.Column="0" 
                                                          Text="{Binding ActualDate, StringFormat='Выполнено: {0:dd.MM.yyyy}'}" 
                                                          FontSize="9"
                                                          Foreground="#27AE60"
                                                          VerticalAlignment="Center"/>

                                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                                    <Button Content="📋" 
                                                            Command="{Binding DataContext.DuplicateTaskCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                            CommandParameter="{Binding}"
                                                            ToolTip="Дублировать"
                                                            Width="24" 
                                                            Height="24"
                                                            Margin="2,0"/>
                                                    <Button Content="🗑️" 
                                                            Command="{Binding DataContext.DeleteTaskCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                            CommandParameter="{Binding}"
                                                            ToolTip="Удалить"
                                                            Width="24" 
                                                            Height="24"
                                                            Margin="2,0"
                                                            Background="#E74C3C"
                                                            Foreground="White"/>
                                                </StackPanel>
                                            </Grid>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>

                <!-- Боковая панель с уведомлениями -->
                <Border Background="#ECF0F1" CornerRadius="8" Margin="8" Padding="12" Width="280">
                    <StackPanel>
                        <TextBlock Text="📊 Статистика и уведомления" 
                                  FontWeight="Bold" 
                                  FontSize="14"
                                  Margin="0,0,0,12"/>

                        <!-- Просроченные задачи -->
                        <Border Background="#E74C3C" CornerRadius="6" Padding="10" Margin="0,0,0,8">
                            <StackPanel>
                                <TextBlock Text="⚠️ Просроченные задачи" 
                                          Foreground="White" 
                                          FontWeight="Bold"
                                          FontSize="12"/>
                                <TextBlock Text="{Binding OverdueTasks.Count}" 
                                          Foreground="White" 
                                          FontSize="18"
                                          FontWeight="Bold"
                                          Margin="0,4,0,0"/>
                            </StackPanel>
                        </Border>

                        <!-- Ближайшие задачи -->
                        <Border Background="#3498DB" CornerRadius="6" Padding="10" Margin="0,0,0,8">
                            <StackPanel>
                                <TextBlock Text="📅 Ближайшие задачи (7 дней)" 
                                          Foreground="White" 
                                          FontWeight="Bold"
                                          FontSize="12"/>
                                <TextBlock Text="{Binding UpcomingTasks.Count}" 
                                          Foreground="White" 
                                          FontSize="18"
                                          FontWeight="Bold"
                                          Margin="0,4,0,0"/>
                            </StackPanel>
                        </Border>

                        <!-- Финансовая статистика -->
                        <Border Background="#27AE60" CornerRadius="6" Padding="10">
                            <StackPanel>
                                <TextBlock Text="💰 Финансы" 
                                          Foreground="White" 
                                          FontWeight="Bold"
                                          FontSize="12"/>
                                <TextBlock Text="{Binding TotalEstimatedCost, StringFormat='Бюджет: {0:C}'}" 
                                          Foreground="White" 
                                          FontSize="11"
                                          Margin="0,4,0,0"/>
                                <TextBlock Text="{Binding TotalActualCost, StringFormat='Факт: {0:C}'}" 
                                          Foreground="White" 
                                          FontSize="11"
                                          Margin="0,2,0,0"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Window>